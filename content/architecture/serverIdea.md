---
title: Основная логика работы сервера
---

Технологии, которые используются на сервере:

- [Express.js](https://expressjs.com/)
- [WS.js](https://github.com/websockets/ws)
- [MongoDB](https://www.mongodb.com)

Для того чтобы вести разработку в тестовой среде достаточно просто ввести следующие команды _в корне репозитория_:

```bash
pnpm install
pnpm env:dev
pnpm serve
```

Сервер запустится по адресу `localhost:4000`. Все API запросы естественно тоже должны происходить от данного BASE_URL.

Планируется следующий функционал:

- Сервер будет создавать комнаты для пользователей
- Сервер будет проверять существуют ли уже созданные комнаты с определенным UUID
- Сервер будет отдавать каждому пользователю уникальный UUID для того чтобы пользователи могли узнать кто ещё есть в определенной комнате
- Сервер будет хранить WebRTC хэндшейки

# Создание комнат

Для того чтобы пользователь создал комнату достаточно просто отправить серверу GET-запрос `BASE_URL/create`. Сервер в свою очередь должен будет отдать уникальный UUID для комнаты, а также подключить WS-соединение с клиентом. Именно с данной временной точки точки комната создана.

## Алгоритм

1. Пользователь переходит на сайт `BASE_URL`
2. У пользователя запрашиваются разрешения на использование камеры и микрофона
3. После разрешения пользователя пользователь отправляет запрос `/create`
4. Сервер отдает уникальный UUID

# Подключение к комнатам

Если серверу передан URL с уникальным UUID комнаты, то сервер должен проверить есть ли такая комната. Если комната существует, то пользователь подключается к данной комнате, осуществляется соединение по WS-соединению. Скорее всего в дальнейшем будут разработаны комнаты с паролем, поэтому нужно предусмотреть заранее данные изменения.

Если такой функционал в дальнейшем понадобится, то скорее всего сервер будет отдавать отдельное сообщение, чтобы приложение показало форму с вводом пароля.

## Алгоритм

1. Пользователь переходит на сайт `BASE_URL/connect/uuid`
2. Сервер проверяет существует ли такой UUID
3. Если UUID существует, то сервер подключается с пользователем по WS-соединению и отдает необходимые хендшейки
4. Если UUID не существует, то сервер отправляет пользователя на `BASE_URL`
