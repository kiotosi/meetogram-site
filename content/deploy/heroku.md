---
title: Деплой в Heroku
---

Для того чтобы задеплоить приложение в Heroku для начала нужно скачать `heroku-cli`. Сделать это можно с [официального сайта](https://devcenter.heroku.com/articles/heroku-cli#install-the-heroku-cli) или же скачав `heroku-cli` с помощью npm:

```bash
npm i -g heroku
```

<small>Установка Heroku-cli</small>

> Разработчики Heroku не рекомендуют использовать скачивание через NPM, однако это единственный знакомый мне способ, как заставить работать `heroku-cli` на Mac с процессорами M1.

После того как мы установили `heroku-cli`, мы можем перейти к следующим этапу - регистрация.

## Вход в Heroku

Для того чтобы войти в Heroku, достаточно просто написать:

```bash
heroku login
```

<small>Логин в Heroku</small>

## Создание приложения

После того как мы вошли в Heroku - нам нужно создать приложение. Сделать это можно следующим образом:

```bash
heroku create -s container meetogram
```

<small>Создание приложения со стеком Docker. Имя устанавливаем meetogram</small>

> С помощью флага `-s container` мы сразу даем понять Heroku, что будем использовать Docker-контейнер. Если вы упустили данный шаг - ничего страшного. Достаточно просто ввести `heroku stack:set container -a meetogram`

## Вход в Heroku Container

Для того чтобы войти в Heroku Container вам понадобится следующая команда:

```bash
heroku container:login
```

Вы также можете войти с помощью самого Docker. Для этого вам для начала нужно узнать ключ Heroku API. Это можно сделать с помощью команды `heroku auth:token` или на [сайте Heroku](https://dashboard.heroku.com/account).

```bash
docker login --username=<ваша почта> --password=<ваш API-ключ> registry.heroku.com
```

> **Важно**: У вас на данном этапе должен быть включен Docker Daemon.

## Пуш контейнера

После того как мы успешно создали приложение нам нужно создать образ нашего контейнера, делается это также, как уже было описано:

```bash
docker build -t web .
```

> Имя контейнера важно. `web` говорит о том, что мы будем разворачивать веб-приложение. Помимо `web` также есть `worker`, однако в данном приложении он не используется.
>
> Вы можете использовать свое имя. Просто тогда вам придется чуть дольше провозиться с настройкой [dyno](https://devcenter.heroku.com/articles/dyno-types)

После того как мы собрали контейнер - необходимо запушить его на сервер Heroku:

```bash
heroku container push web -a meetogram
```

## Релиз контейнера

Запустить контейнер в сеть можно с помощью команды:

```bash
heroku container:release web -a meetogram
```

В случае если что-то пойдет не так вы всегда можете воспользоваться данной командой:

```bash
heroku logs --tail -a meetogram
```

### Запуск контейнера локально

Если логи не помогли вам в решении проблемы, то вы можете запулить контейнер, который вы отправили в Heroku обратно и посмотреть запускается ли он у вас. Для этого достаточно написать команду:

```bash
heroku container:run web -a meetogram
```

## Автоматический деплой

В данном репозитории есть Github Actions, которые позволяют деплоить контейнер при создании нового релиза (тега). Советую ознакомиться с файлом `.github/workflows/deploy.yml`
